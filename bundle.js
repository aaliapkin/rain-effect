(()=>{var e={472:(e,r,t)=>{"use strict";t.r(r);var i={x:null,y:null};window.addEventListener("mousemove",(function(e){i.x=e.x,i.y=e.y}));const n=i;function a(e,r,t,i,n){return i+(n-i)/(t-r)*((e=(e=(e=void 0===e?t:e)>t?t:e)<r?r:e)-r)}function s(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(r){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=r,this.uniforms=[],this.positionLocation=null}var r,t;return r=e,(t=[{key:"createProgram",value:function(e,r){var t=this.gl,i=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER),a=t.shaderSource(i,e),s=t.shaderSource(n,r);t.compileShader(i,a),t.getShaderParameter(i,t.COMPILE_STATUS)||(alert("Error compiling vertex shader"),console.log(t.getShaderInfoLog(i))),t.compileShader(n,s),t.getShaderParameter(n,t.COMPILE_STATUS)||(alert("Error compiling fragment shader"),console.log(t.getShaderInfoLog(n)));var o=t.createProgram();t.attachShader(o,i),t.attachShader(o,n),t.linkProgram(o),t.validateProgram(o),t.getProgramParameter(o,t.VALIDATE_STATUS)?this.program=o:console.log("Error validating program ",t.getProgramInfoLog(o))}},{key:"useProgram",value:function(){this.gl.useProgram(this.program)}},{key:"addUniform",value:function(e,r){var t={name:e,type:r,uniform:this.gl.getUniformLocation(this.program,e)};this.uniforms.push(t)}},{key:"setUniform",value:function(){var e=arguments[0],r=this.uniforms.find((function(r){return r.name===e}));if(r)switch(r.type){case"4fv":return void this.gl.uniformMatrix4fv(r.uniform,!1,arguments[1]);case"1f":return void this.gl.uniform1f(r.uniform,arguments[1]);case"2f":return void this.gl.uniform2f(r.uniform,arguments[1],arguments[2]);case"1i":return void this.gl.uniform1i(r.uniform,arguments[1])}}},{key:"setPositions",value:function(e){this.positionLocation=this.gl.getAttribLocation(this.program,e),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0)}}])&&s(r.prototype,t),e}();function u(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(r){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=r,this.level=0,this.internalFormat=this.gl.RGBA,this.border=0,this.format=this.gl.RGBA,this.srcFormat=this.gl.RGBA,this.type=this.gl.UNSIGNED_BYTE,this.data=null,this.srcType=this.gl.UNSIGNED_BYTE,this.pixel=new Uint8Array([106,163,149,255]),this.texture=null}var r,t;return r=e,(t=[{key:"fromUrl",value:function(e){var r=this,t=this.gl;this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,this.level,this.internalFormat,this.width,this.height,this.border,this.srcFormat,this.srcType,this.pixel);var i=new Image;return i.onload=function(){t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,r.level,r.internalFormat,r.srcFormat,r.srcType,i),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR)},i.src=e,this.texture}},{key:"empty",value:function(e,r){var t=this.gl;return this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),this.data=null,this.targetTextureWidth=e,this.targetTextureHeight=r,t.texImage2D(t.TEXTURE_2D,this.level,this.internalFormat,this.targetTextureWidth,this.targetTextureHeight,this.border,this.srcFormat,this.srcType,this.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.texture}}])&&u(r.prototype,t),e}(),h=t(959),f=t.n(h),m=t(516),c=t.n(m),v=t(985),d=t.n(v);function p(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.cnv=null,this.gl=null,this.size={w:0,h:0,cx:0,cy:0},this.lastFrameTime=0,this.currentFrameTime=0,this.fps=60,this.fpsHistory=[],this.proj=[],this.psize=5,this.startTime=0,this.time=0,this.texture=null,this.texture2=null,this.texture3=null,this.uvmouse={x:0,y:0},this.lastmousepos={x:0,y:0},this.mouseintensity=0}var r,t;return r=e,(t=[{key:"init",value:function(){this.createCanvas(),this.updateAnimation()}},{key:"calculateMVP",value:function(){this.size.w,this.size.h,this.proj=[2,0,0,-1,0,-2,0,1,0,0,2,-1,0,0,0,1]}},{key:"createCanvas",value:function(){var e=this;this.cnv=document.createElement("canvas"),document.body.appendChild(this.cnv),this.cnv.id="canvas";var r=this.gl=this.cnv.getContext("webgl2");this.rainShader=new o(r),this.rainShader.createProgram(f(),d()),this.heatmapShader=new o(r),this.heatmapShader.createProgram(f(),c());var t=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,t),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),r.STATIC_DRAW);var i=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,2,3,0]),r.STATIC_DRAW),this.heatmapShader.useProgram(),this.heatmapShader.setPositions("aPos"),this.heatmapShader.addUniform("u_Sampler","1i"),this.heatmapShader.addUniform("u_Mouse","2f"),this.heatmapShader.addUniform("u_time","1f"),this.heatmapShader.addUniform("u_MVP","4fv"),this.heatmapShader.addUniform("u_asp","1f"),this.rainShader.useProgram(),this.rainShader.setPositions("aPos"),this.rainShader.addUniform("u_MVP","4fv"),this.rainShader.addUniform("u_time","1f"),this.rainShader.addUniform("u_Size","1f"),this.rainShader.addUniform("u_Sampler","1i"),this.rainShader.addUniform("u_SamplerH","1i"),this.rainShader.addUniform("u_Mouse","2f"),this.rainShader.addUniform("u_MouseInt","1f"),this.rainShader.addUniform("u_asp","1f"),this.setCanvasSize(),window.addEventListener("resize",(function(){e.setCanvasSize()})),this.startTime=Date.now(),this.texture=new l(r).fromUrl("img/bg1.jpg"),this.targetTextureWidth=this.size.w,this.targetTextureHeight=this.size.h,this.texture2=new l(r).empty(this.targetTextureWidth,this.targetTextureHeight),this.texture3=new l(r).empty(this.targetTextureWidth,this.targetTextureHeight),this.frameBuffer=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer);var n=r.COLOR_ATTACHMENT0;r.framebufferTexture2D(r.FRAMEBUFFER,n,r.TEXTURE_2D,this.texture2,0)}},{key:"updateCanvas",value:function(){this.time=(Date.now()-this.startTime)/1e3,this.calculateMVP(),this.getMouse(),this.drawHeatMap(),this.drawImage(),this.swapTextures()}},{key:"drawImage",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.rainShader.useProgram(),this.rainShader.setUniform("u_MVP",this.proj),this.rainShader.setUniform("u_time",this.time),this.rainShader.setUniform("u_Size",this.psize),this.rainShader.setUniform("u_Mouse",this.uvmouse.x,this.uvmouse.y),this.rainShader.setUniform("u_MouseInt",this.mouseintensity),this.rainShader.setUniform("u_asp",this.size.w/this.size.h),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),this.rainShader.setUniform("u_Sampler",0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.texture2),this.rainShader.setUniform("u_SamplerH",1),this.gl.viewport(0,0,this.size.w,this.size.h),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}},{key:"drawHeatMap",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture2);var r=e.COLOR_ATTACHMENT0;e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,this.texture2,0),this.heatmapShader.useProgram(),this.heatmapShader.setUniform("u_Mouse",this.uvmouse.x,this.uvmouse.y),this.heatmapShader.setUniform("u_time",this.time),this.heatmapShader.setUniform("u_MVP",this.proj),this.heatmapShader.setUniform("u_asp",this.size.w/this.size.h),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.texture3),this.heatmapShader.setUniform("u_Sampler",1),e.viewport(0,0,this.targetTextureWidth,this.targetTextureHeight),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"swapTextures",value:function(){var e=this.texture2;this.texture2=this.texture3,this.texture3=e}},{key:"setCanvasSize",value:function(){this.size.w=this.cnv.width=window.innerWidth,this.size.h=this.cnv.height=window.innerHeight,this.size.cx=this.size.w/2,this.size.cy=this.size.h/2,this.gl.viewport(0,0,this.size.w,this.size.h)}},{key:"getMouse",value:function(){var e=n.x,r=n.y;e>0&&e<this.size.w&&r>0&&r<this.size.h?this.uvmouse={x:a(e,0,this.size.w,0,1),y:a(r,0,this.size.h,0,1)}:this.uvmouse={x:-1,y:-1}}},{key:"calculateFps",value:function(){if(0==this.lastFrameTime)this.lastFrameTime=this.time;else if(this.currentFrameTime=this.time-this.lastFrameTime,this.fpsHistory.push(1/this.currentFrameTime),this.lastFrameTime=this.time,this.fpsHistory.length>20){var e=this.fpsHistory.reduce((function(e,r){return e+r}),0)/this.fpsHistory.length||0;this.fps=e,this.fpsHistory=[]}}},{key:"updateAnimation",value:function(){var e=this;this.updateCanvas(),this.calculateFps(),window.requestAnimationFrame((function(){e.updateAnimation()}))}}])&&p(r.prototype,t),e}();window.onload=function(){(new g).init()}},307:(e,r,t)=>{"use strict";t.r(r)},516:e=>{e.exports="#version 300 es\r\n\r\nprecision highp float;\r\n\r\n#define S(a, b, t) smoothstep(a, b, t)\r\n#define _2PI 6.28318530718\r\n\r\nout vec4 FragColor;\r\nin vec2 uv;\r\n\r\nuniform float u_time;\r\nuniform sampler2D u_Sampler;\r\nuniform float u_asp;\r\nuniform vec2 u_Mouse;\r\n\r\nfloat N21(vec2 p) {\r\n  p = fract(p * vec2(123.34f, 345.45f));      \r\n  p += dot(p, p + 34.345f);\r\n  return fract(p.x * p.y);      \r\n}\r\n\r\nvec4 SampleBlur(sampler2D u_Sampler, vec2 sampleuv, float Directions, float Quality, float Size, vec2 Radius, float mip) {\r\n  vec4 Color = texture(u_Sampler, sampleuv, mip);\r\n  for(float d = 0.0; d < _2PI; d += _2PI/Directions) {\r\n    for(float i = 1.0 / Quality; i <= 1.0; i += 1.0 / Quality) {\r\n      Color += texture(u_Sampler, sampleuv + vec2(cos(d), sin(d)) * Radius * i, mip);\t\t\r\n    }\r\n  }\r\n  Color /= Quality * Directions;\r\n  return Color;\r\n}\r\n\r\nvoid main()\r\n{\r\n  vec2 asp = vec2(u_asp / 1.4, 1.0); // texture aspect\r\n  float t = mod(u_time, 72000.0);\r\n  vec2 mouse = u_Mouse;\r\n  vec2 uv1 = uv;\r\n  uv1.y = 1.0 - uv1.y;\r\n\r\n  // Sampler UV Directions Quality Size Radius Mip\r\n  vec4 BlurColor = SampleBlur(u_Sampler, uv1, 6.0, 2.0, 0.5, vec2(0.01), 2.0);\r\n\r\n  float mouseCircle = S(0.3f, 0.0f, length((mouse - uv1) * asp )) ;\r\n\r\n  FragColor = BlurColor + 0.03 * mouseCircle;\r\n  FragColor *= 0.918;\r\n  FragColor = clamp(FragColor, 0.0, 1.0);\r\n}"},985:e=>{e.exports="#version 300 es\r\n\r\nprecision highp float;\r\n\r\n#define S(a, b, t) smoothstep(a, b, t)\r\n#define _2PI 6.28318530718\r\n\r\nout vec4 FragColor;\r\nin vec2 uv;\r\n\r\nuniform float u_time;\r\nuniform float u_Size;\r\nuniform sampler2D u_Sampler;\r\nuniform sampler2D u_SamplerH;\r\nuniform float u_MouseInt;\r\nuniform float u_asp;\r\nuniform vec2 u_Mouse;\r\n\r\nfloat N21(vec2 p) {\r\n  p = fract(p * vec2(123.34f, 345.45f));      \r\n  p += dot(p, p + 34.345f);\r\n  return fract(p.x * p.y);      \r\n}\r\n\r\nfloat blendScreen(float base, float blend) {\r\n\treturn 1.0-((1.0-base)*(1.0-blend));\r\n}\r\n\r\nvec3 blendScreen(vec3 base, vec3 blend) {\r\n\treturn vec3(blendScreen(base.r,blend.r),blendScreen(base.g,blend.g),blendScreen(base.b,blend.b));\r\n}\r\n\r\nvec3 blendScreen(vec3 base, vec3 blend, float opacity) {\r\n\treturn (blendScreen(base, blend) * opacity + base * (1.0 - opacity));\r\n}\r\n\r\nvec4 blendScreen(vec4 base, vec4 blend, float opacity) {\r\n\treturn vec4(blendScreen(base.xyz, blend.xyz, opacity), 1.0);\r\n}\r\n\r\n\r\nvec4 SampleBlur(sampler2D u_Sampler, vec2 sampleuv, float Directions, float Quality, float Size, vec2 Radius, float mip) {\r\n  vec4 Color = texture(u_Sampler, sampleuv, mip);\r\n  for(float d = 0.0; d < _2PI; d += _2PI/Directions) {\r\n    for(float i = 1.0 / Quality; i <= 1.0; i += 1.0 / Quality) {\r\n      Color += texture(u_Sampler, sampleuv + vec2(cos(d), sin(d)) * Radius * i, mip);\t\t\r\n    }\r\n  }\r\n  Color /= Quality * Directions;\r\n  return Color;\r\n}\r\n\r\nvec3 Layer(vec2 UV, float t) {\r\n  \r\n  vec2 asp = vec2(2.0f, 1.0f); // y: 2, x: 1\r\n  vec2 uv1 = UV * u_Size * asp;\r\n  uv1.y = -uv1.y;\r\n  uv1.y += t * .25f;\r\n  vec2 gv = fract(uv1) - .5f;\r\n  vec2 id = floor(uv1);\r\n\r\n  float n = N21(id);\r\n  t += n * 6.2831;\r\n  \r\n  float w = UV.y * 10.0f;\r\n  float x = (n - 0.5f) * .8f;\r\n  x += (.4f - abs(x)) * sin(3.0f * w) * pow(sin(w), 6.0f) * .45f;\r\n\r\n  float y = -sin(t + sin(t + sin(t) * .5f)) * .45f;\r\n  y -= (gv.x - x) * (gv.x - x);\r\n\r\n  vec2 dropPos = (gv - vec2(x, y)) / asp;\r\n  float drop = S(.035f, .025f, length(dropPos));\r\n\r\n  vec2 trailPos = (gv - vec2(x, t * .25f)) / asp;\r\n  trailPos.y = (fract(trailPos.y * 16.0f) - 0.5f) / 16.0f;\r\n  float trail = S(.03f, .001f, length(trailPos)) * .4f;\r\n  float fogTrail = S(-.1f, .1f, dropPos.y);\r\n  fogTrail *= S(.5f, y, gv.y);\r\n  trail *= fogTrail;\r\n  fogTrail *= S(0.03f, 0.02f, abs(dropPos.x));\r\n\r\n  vec2 offs = drop * dropPos * .6 + trail * trailPos * .4;\r\n\r\n  return vec3(offs, fogTrail);\r\n}\r\n\r\nvoid main()\r\n{\r\n  vec2 asp = vec2(u_asp, 1.0);\r\n  // cycle time to avoid precision drop\r\n  float t = mod(u_time, 72000.0);\r\n\r\n  float imgasp = u_asp / 1.4; // image aspect ratio\r\n  vec2 sampleuv;\r\n  if (imgasp > 1.0) { \r\n    sampleuv = (uv - vec2(0.5)) * vec2(1.0, 1.0 / imgasp) + vec2(0.5);\r\n  } else {\r\n    sampleuv = (uv - vec2(0.5)) * vec2(imgasp, 1.0) + vec2(0.5);\r\n  }\r\n\r\n  vec2 uv1 = uv * asp;\r\n\r\n  FragColor = vec4(0.0f);\r\n\r\n  vec3 drops = Layer(uv1, t);\r\n  drops += Layer(uv1 * 1.73f + 1.75f, t + 1.87);\r\n  drops += Layer(uv1 * 1.13f + 7.03f, t + 3.31);\r\n\r\n  float blur = (1.0f - drops.z);\r\n  vec2 uvoff = sampleuv + drops.xy;\r\n  \r\n  // Sampler UV Directions Quality Size Radius Mip\r\n  vec4 Color = SampleBlur(u_Sampler, sampleuv, 12.0, 6.0, 2.0, vec2(0.05), 2.0);\r\n  Color = blendScreen(Color, vec4(1.0), 0.05);\r\n\r\n  float mouseHeat = texture(u_SamplerH, sampleuv).x;\r\n  blur *= (1.0f - mouseHeat);\r\n\r\n  vec4 BaseColor = texture(u_Sampler, uvoff) * 0.9;\r\n  FragColor = mix(BaseColor, Color, blur);\r\n  // FragColor = vec4(mouseHeat);\r\n}"},959:e=>{e.exports="#version 300 es\r\n\r\nprecision highp float;\r\nlayout(location = 0) in vec2 aPos;\r\n\r\nout vec2 uv;\r\n\r\nuniform mat4 u_MVP;\r\n\r\nvoid main() {\r\n  gl_Position = vec4(aPos, .0f, 1.0f);\r\n  vec4 uv_out =  gl_Position * inverse(u_MVP);\r\n  uv = uv_out.xy;\r\n}"}},r={};function t(i){var n=r[i];if(void 0!==n)return n.exports;var a=r[i]={exports:{}};return e[i](a,a.exports,t),a.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(307),t(472)})();
//# sourceMappingURL=bundle.js.map